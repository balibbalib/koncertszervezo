<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Koncertszervez≈ë - Keleti Reform</title>
<style>
  body {
    background-color: #0d0d0d;
    color: #e0e0e0;
    font-family: 'Segoe UI', sans-serif;
    margin: 0;
    padding: 0;
  }

  .logo-header {
    text-align: center;
    padding: 25px 10px;
    background: linear-gradient(45deg, #1782ca, #2935f1);
  }

  .logo-header img {
    width: 160px;
    margin-bottom: 10px;
    border-radius: 10px;
  }

  h1 {
    text-align: center;
    color: #b3d9ff;
    margin: 10px 0;
    font-weight: 600;
  }

  .container {
    display: flex;
    justify-content: space-around;
    flex-wrap: wrap;
    padding: 20px;
    gap: 20px;
  }

  .list, .setlist {
    background-color: #1b1b1b;
    border: 1px solid #3d6cb9;
    border-radius: 12px;
    padding: 15px;
    width: 340px;
    min-height: 400px;
    margin: 10px;
    box-shadow: 0 0 12px rgba(61,108,185,0.25);
  }

  .list h2, .setlist h2 {
    text-align: center;
    color: #a8a0ff;
    font-weight: 600;
  }

  .song {
    padding: 10px 12px;
    margin: 6px 0;
    background-color: #242424;
    border-radius: 6px;
    cursor: grab;
    transition: background 0.2s;
    font-size: 0.95em;
  }

  .song:hover {
    background-color: #2f2f2f;
  }

  .song.dragging {
    opacity: 0.6;
  }

  .setlist .song-placeholder {
    background-color: #2a2a2a;
    border: 2px dashed #4da6ff;
    height: 42px;
    margin: 5px 0;
    border-radius: 6px;
  }

  button {
    border: none;
    color: #0d0d0d;
    padding: 10px 14px;
    margin: 10px auto;
    display: block;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    transition: background 0.2s;
  }

  button.primary {
    background-color: #4da6ff;
  }

  button.primary:hover {
    background-color: #66b3ff;
  }

  button.danger {
    background-color: #ff4d4d;
    color: #fff;
  }

  button.danger:hover {
    background-color: #ff6666;
  }

  .summary {
    text-align: center;
    margin-top: 10px;
    color: #ffcc66;
    font-weight: 500;
  }

  #songList {
    max-height: 500px;
    overflow-y: auto;
    padding-right: 5px;
  }

  @media (max-width: 768px) {
    .container {
      flex-direction: column;
      align-items: center;
    }

    .list, .setlist {
      width: 90%;
      min-height: auto;
    }

    h1 {
      font-size: 1.8em;
    }

    .song {
      font-size: 1em;
      padding: 12px;
    }

    button {
      width: 100%;
      font-size: 1em;
    }

    .logo-header img {
      width: 120px;
    }
  }
</style>
</head>
<body>

<div class="logo-header">
  <img src="https://drive.google.com/thumbnail?id=1aaPOxP4OkfsfMd8t3QcSAI5TIx5YN4pl&sz=800" alt="Keleti Reform Logo">
  <h1>Koncertszervez≈ë</h1>
</div>

<div class="container">
  <div class="list">
    <h2>Dalok</h2>
    <div id="songList"></div>
  </div>

  <div class="setlist">
    <h2>Setlist</h2>
    <div id="setList"></div>
    
    <button class="primary" id="addSlot">+ Hely hozz√°ad√°sa</button>
    <button class="danger" id="clearSetlist">üóëÔ∏è Setlist t√∂rl√©se</button>
    <button class="primary" id="shareSetlist">üì§ Megoszt√°s / M√°sol√°s</button>
    
    <div class="summary" id="summary">√ñsszesen: 0 dal, 0:00</div>
  </div>
</div>

<script>
const songList = document.getElementById('songList');
const setList = document.getElementById('setList');
const summary = document.getElementById('summary');
const addSlotBtn = document.getElementById('addSlot');
const clearBtn = document.getElementById('clearSetlist');
const shareBtn = document.getElementById('shareSetlist');

function createSongElement(song) {
  const div = document.createElement('div');
  div.className = 'song';
  div.draggable = true;

  let text = `${song.name} (${song.time})`;
  if (song.flute === "normal") text += " üéµ";
  if (song.flute === "high") text += " üéµ‚¨ÜÔ∏è";

  div.innerText = text;
  div.dataset.time = song.time;
  div.dataset.name = song.name;

  div.addEventListener('dragstart', e => {
    e.dataTransfer.setData('text/plain', JSON.stringify(song));
    setTimeout(() => div.classList.add('dragging'), 0);
  });
  div.addEventListener('dragend', () => div.classList.remove('dragging'));

  // Mobil: kattint√°sra is hozz√°ad√°s
  div.addEventListener('click', () => {
    const emptySlot = Array.from(setList.children).find(c => c.classList.contains('song-placeholder'));
    if (emptySlot) {
      const songDiv = createSongElement(song);
      setList.replaceChild(songDiv, emptySlot);
      updateSummary();
    }
  });

  return div;
}

function createPlaceholder() {
  const div = document.createElement('div');
  div.className = 'song-placeholder';
  div.addEventListener('dragover', e => e.preventDefault());
  div.addEventListener('drop', e => {
    e.preventDefault();
    const data = JSON.parse(e.dataTransfer.getData('text/plain'));
    const songDiv = createSongElement(data);
    setList.replaceChild(songDiv, div);
    updateSummary();
  });
  return div;
}

function updateSummary() {
  const songsInSet = Array.from(setList.children)
    .filter(c => c.classList.contains('song'));
  let totalSeconds = 0;
  songsInSet.forEach(s => {
    const [min, sec] = s.dataset.time.split(':').map(Number);
    totalSeconds += min * 60 + sec;
  });
  const minutes = Math.floor(totalSeconds / 60);
  const seconds = totalSeconds % 60;
  summary.innerText = `√ñsszesen: ${songsInSet.length} dal, ${minutes}:${seconds.toString().padStart(2,'0')}`;
}

// üóëÔ∏è Setlist t√∂rl√©se
clearBtn.addEventListener('click', () => {
  setList.innerHTML = '';
  for (let i = 0; i < 5; i++) setList.appendChild(createPlaceholder());
  updateSummary();
});

// üì§ Megoszt√°s / M√°sol√°s
shareBtn.addEventListener('click', async () => {
  const songs = Array.from(setList.children)
    .filter(c => c.classList.contains('song'))
    .map(s => s.dataset.name);

  if (songs.length === 0) {
    alert('Nincs mit megosztani ‚Äî a setlist √ºres!');
    return;
  }

  const text = "üé∂ Keleti Reform Setlist üé∂\n\n" + songs.join('\n');

  if (navigator.share) {
    // Mobilon megoszt√°s alkalmaz√°sokba
    try {
      await navigator.share({
        title: 'Keleti Reform Setlist',
        text: text
      });
    } catch (err) {
      console.error('Megoszt√°s megszak√≠tva vagy hiba:', err);
    }
  } else {
    // Asztali g√©pen v√°g√≥lapra m√°sol√°s
    await navigator.clipboard.writeText(text);
    alert('‚úÖ A setlist v√°g√≥lapra m√°solva!');
  }
});

// Dalok bet√∂lt√©se JSON-b≈ël
fetch('songs.json')
  .then(response => response.json())
  .then(data => {
    data.forEach(song => songList.appendChild(createSongElement(song)));
  })
  .catch(err => {
    console.error('Hiba a dalok bet√∂lt√©s√©n√©l:', err);
    songList.innerHTML = "<p style='text-align:center;color:#ff6666;'>Nem siker√ºlt bet√∂lteni a dalokat.</p>";
  });

// Alap 5 hely
for (let i = 0; i < 5; i++) setList.appendChild(createPlaceholder());
addSlotBtn.addEventListener('click', () => setList.appendChild(createPlaceholder()));
</script>

</body>
</html>